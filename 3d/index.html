<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>3D Grid & Vector Transformation Visualizer</title>
    <link rel="stylesheet" href="../css/3d.css">
</head>
<body>
    <div class="container">
        <a href="../index.html" class="back-link">← Back to Navigation</a>
        <h1>3D Grid & Vector Transformation Visualizer</h1>
        
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background: #007bff;"></div>
                <span>Original Cube</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #ff6b6b;"></div>
                <span>Transformed Cube</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #28a745;"></div>
                <span>Coordinate Axes</span>
            </div>
        </div>
        
        <div class="main-layout">
            <div class="controls">
            <div class="control-group">
                <h3>Transformation Matrix (3x3)</h3>
                <div class="matrix-input-container">
                    <div class="matrix-row">
                        <input type="number" id="a11" value="1" step="0.1" onchange="applyTransformation()">
                        <input type="number" id="a12" value="0" step="0.1" onchange="applyTransformation()">
                        <input type="number" id="a13" value="0" step="0.1" onchange="applyTransformation()">
                    </div>
                    <div class="matrix-row">
                        <input type="number" id="a21" value="0" step="0.1" onchange="applyTransformation()">
                        <input type="number" id="a22" value="1" step="0.1" onchange="applyTransformation()">
                        <input type="number" id="a23" value="0" step="0.1" onchange="applyTransformation()">
                    </div>
                    <div class="matrix-row">
                        <input type="number" id="a31" value="0" step="0.1" onchange="applyTransformation()">
                        <input type="number" id="a32" value="0" step="0.1" onchange="applyTransformation()">
                        <input type="number" id="a33" value="1" step="0.1" onchange="applyTransformation()">
                    </div>
                </div>
                <div class="transformation-info" id="transformationInfo">
                    <div>Matrix: [1.00  0.00  0.00]</div>
                    <div>        [0.00  1.00  0.00]</div>
                    <div>        [0.00  0.00  1.00]</div>
                    <div>Determinant: 1.00</div>
                </div>
                <button onclick="resetGrid()">Reset</button>
            </div>
            
            <div class="control-group">
                <h3>Camera Controls</h3>
                <div class="camera-controls">
                    <div class="camera-row">
                        <label>Rot X: <input type="range" id="cameraRotX" min="-360" max="360" value="30" step="1" oninput="updateCamera()"></label>
                        <span id="cameraRotXValue">30°</span>
                    </div>
                    <div class="camera-row">
                        <label>Rot Y: <input type="range" id="cameraRotY" min="-360" max="360" value="45" step="1" oninput="updateCamera()"></label>
                        <span id="cameraRotYValue">45°</span>
                    </div>
                    <div class="camera-row">
                        <label>Rot Z: <input type="range" id="cameraRotZ" min="-360" max="360" value="0" step="1" oninput="updateCamera()"></label>
                        <span id="cameraRotZValue">0°</span>
                    </div>
                    <div class="camera-row">
                        <label>Zoom: <input type="range" id="cameraZoom" min="0.1" max="5" value="1" step="0.1" oninput="updateCamera()"></label>
                        <span id="cameraZoomValue">1.0x</span>
                    </div>
                </div>
                <button onclick="resetCamera()" style="margin-top: 10px;">Reset Camera</button>
            </div>
            
            <div class="control-group">
                <h3>Object Rotation</h3>
                <div class="rotation-controls">
                    <div class="rotation-group">
                        <h4>X-Axis Rotation</h4>
                        <input type="range" id="rotX" min="0" max="360" value="0" step="1" oninput="applyRotation()">
                        <span id="rotXValue">0°</span>
                    </div>
                    <div class="rotation-group">
                        <h4>Y-Axis Rotation</h4>
                        <input type="range" id="rotY" min="0" max="360" value="0" step="1" oninput="applyRotation()">
                        <span id="rotYValue">0°</span>
                    </div>
                    <div class="rotation-group">
                        <h4>Z-Axis Rotation</h4>
                        <input type="range" id="rotZ" min="0" max="360" value="0" step="1" oninput="applyRotation()">
                        <span id="rotZValue">0°</span>
                    </div>
                    <div class="rotation-group">
                        <h4>Scale</h4>
                        <input type="range" id="scale" min="0.1" max="3" value="1" step="0.1" oninput="applyRotation()">
                        <span id="scaleValue">1.0</span>
                    </div>
                </div>
            </div>
            
            <div class="control-group">
                <h3>Preset Transformations</h3>
                <div class="preset-buttons">
                    <button class="preset-btn" onclick="setPreset('identity')">Identity</button>
                    <button class="preset-btn" onclick="setPreset('rotationX90')">X-Rotation 90°</button>
                    <button class="preset-btn" onclick="setPreset('rotationY90')">Y-Rotation 90°</button>
                    <button class="preset-btn" onclick="setPreset('rotationZ90')">Z-Rotation 90°</button>
                    <button class="preset-btn" onclick="setPreset('scaling')">Scaling (2x)</button>
                    <button class="preset-btn" onclick="setPreset('shear')">Shear</button>
                </div>
            </div>
            </div>
            
            <!-- Mobile camera controls card -->
            <div class="mobile-camera-card">
                <h4>Camera Controls</h4>
                <div class="mobile-camera-row">
                    <label>Rot X: <input type="range" id="mobileCameraRotX" min="-360" max="360" value="30" step="1" oninput="updateMobileCamera()"></label>
                    <span id="mobileCameraRotXValue">30°</span>
                </div>
                <div class="mobile-camera-row">
                    <label>Rot Y: <input type="range" id="mobileCameraRotY" min="-360" max="360" value="45" step="1" oninput="updateMobileCamera()"></label>
                    <span id="mobileCameraRotYValue">45°</span>
                </div>
                <div class="mobile-camera-row">
                    <label>Rot Z: <input type="range" id="mobileCameraRotZ" min="-360" max="360" value="0" step="1" oninput="updateMobileCamera()"></label>
                    <span id="mobileCameraRotZValue">0°</span>
                </div>
                <div class="mobile-camera-row">
                    <label>Zoom: <input type="range" id="mobileCameraZoom" min="0.1" max="5" value="1" step="0.1" oninput="updateMobileCamera()"></label>
                    <span id="mobileCameraZoomValue">1.0x</span>
                </div>
                <button onclick="resetMobileCamera()">Reset Camera</button>
            </div>
            
            <div class="canvas-container">
                <div class="demo-output">
                    <div class="demo-output__container" id="demo__container">
                        <div class="demo-element original-cube" id="original-element">
                            <div class="side side-back">3</div>
                            <div class="side side-bottom">6</div>
                            <div class="side side-right">2</div>
                            <div class="side side-left">4</div>
                            <div class="side side-front">1</div>
                            <div class="side side-top">5</div>
                        </div>
                        <div class="demo-element transformed-cube" id="demo-element">
                            <div class="side side-back">3</div>
                            <div class="side side-bottom">6</div>
                            <div class="side side-right">2</div>
                            <div class="side side-left">4</div>
                            <div class="side side-front">1</div>
                            <div class="side side-top">5</div>
                        </div>
                        <p class="axial-line axial-line--x"></p>
                        <p class="axial-line axial-line--y"></p>
                        <p class="axial-line axial-line--z"></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const demoElement = document.getElementById('demo-element');
        const demoContainer = document.getElementById('demo__container');
        
        let currentMatrix = [
            [1, 0, 0],
            [0, 1, 0],
            [0, 0, 1]
        ];
        
        let zoomFactor = 1.0;
        
        function createRotationX(angle) {
            const rad = angle * Math.PI / 180;
            const cos = Math.cos(rad);
            const sin = Math.sin(rad);
            return [
                [1, 0, 0],
                [0, cos, -sin],
                [0, sin, cos]
            ];
        }
        
        function createRotationY(angle) {
            const rad = angle * Math.PI / 180;
            const cos = Math.cos(rad);
            const sin = Math.sin(rad);
            return [
                [cos, 0, sin],
                [0, 1, 0],
                [-sin, 0, cos]
            ];
        }
        
        function createRotationZ(angle) {
            const rad = angle * Math.PI / 180;
            const cos = Math.cos(rad);
            const sin = Math.sin(rad);
            return [
                [cos, -sin, 0],
                [sin, cos, 0],
                [0, 0, 1]
            ];
        }
        
        function createScalingMatrix(s) {
            return [
                [s, 0, 0],
                [0, s, 0],
                [0, 0, s]
            ];
        }
        
        function multiplyMatrices(a, b) {
            const result = [
                [0, 0, 0],
                [0, 0, 0],
                [0, 0, 0]
            ];
            
            for (let i = 0; i < 3; i++) {
                for (let j = 0; j < 3; j++) {
                    for (let k = 0; k < 3; k++) {
                        result[i][j] += a[i][k] * b[k][j];
                    }
                }
            }
            
            return result;
        }
        
        function calculateDeterminant(matrix) {
            const [[a11, a12, a13], [a21, a22, a23], [a31, a32, a33]] = matrix;
            return a11 * (a22 * a33 - a23 * a32) - 
                   a12 * (a21 * a33 - a23 * a31) + 
                   a13 * (a21 * a32 - a22 * a31);
        }
        
        function matrix3x3ToMatrix3d(matrix) {
            const [[a11, a12, a13], [a21, a22, a23], [a31, a32, a33]] = matrix;
            return [
                a11, a21, a31, 0,
                a12, a22, a32, 0,
                a13, a23, a33, 0,
                0, 0, 0, 1
            ];
        }
        
        function applyTransformation() {
            const a11 = parseFloat(document.getElementById('a11').value);
            const a12 = parseFloat(document.getElementById('a12').value);
            const a13 = parseFloat(document.getElementById('a13').value);
            const a21 = parseFloat(document.getElementById('a21').value);
            const a22 = parseFloat(document.getElementById('a22').value);
            const a23 = parseFloat(document.getElementById('a23').value);
            const a31 = parseFloat(document.getElementById('a31').value);
            const a32 = parseFloat(document.getElementById('a32').value);
            const a33 = parseFloat(document.getElementById('a33').value);
            
            currentMatrix = [[a11, a12, a13], [a21, a22, a23], [a31, a32, a33]];
            updateMatrixDisplay();
            applyMatrix3d();
        }
        
        function applyRotation() {
            const rotX = parseInt(document.getElementById('rotX').value);
            const rotY = parseInt(document.getElementById('rotY').value);
            const rotZ = parseInt(document.getElementById('rotZ').value);
            const scaleVal = parseFloat(document.getElementById('scale').value);
            
            // Update display values
            document.getElementById('rotXValue').textContent = rotX + '°';
            document.getElementById('rotYValue').textContent = rotY + '°';
            document.getElementById('rotZValue').textContent = rotZ + '°';
            document.getElementById('scaleValue').textContent = scaleVal;
            
            const rotXMatrix = createRotationX(rotX);
            const rotYMatrix = createRotationY(rotY);
            const rotZMatrix = createRotationZ(rotZ);
            const scaleMatrix = createScalingMatrix(scaleVal);
            
            // Combine rotations and scaling
            let combinedMatrix = multiplyMatrices(rotXMatrix, rotYMatrix);
            combinedMatrix = multiplyMatrices(combinedMatrix, rotZMatrix);
            combinedMatrix = multiplyMatrices(combinedMatrix, scaleMatrix);
            
            currentMatrix = combinedMatrix;
            
            // Update input fields
            document.getElementById('a11').value = combinedMatrix[0][0];
            document.getElementById('a12').value = combinedMatrix[0][1];
            document.getElementById('a13').value = combinedMatrix[0][2];
            document.getElementById('a21').value = combinedMatrix[1][0];
            document.getElementById('a22').value = combinedMatrix[1][1];
            document.getElementById('a23').value = combinedMatrix[1][2];
            document.getElementById('a31').value = combinedMatrix[2][0];
            document.getElementById('a32').value = combinedMatrix[2][1];
            document.getElementById('a33').value = combinedMatrix[2][2];
            
            updateMatrixDisplay();
            applyMatrix3d();
        }
        
        function applyMatrix3d() {
            const matrix3d = matrix3x3ToMatrix3d(currentMatrix);
            const transform = `matrix3d(${matrix3d.join(', ')})`;
            demoElement.style.transform = transform;
            
            // Check if transformation is identity (no change)
            const isIdentity = currentMatrix.every((row, i) => 
                row.every((val, j) => val === (i === j ? 1 : 0))
            );
            
            // Show/hide transformed cube based on whether transformation is identity
            const transformedCube = document.querySelector('.transformed-cube');
            if (isIdentity) {
                transformedCube.classList.remove('show');
            } else {
                transformedCube.classList.add('show');
            }
        }
        
        function resetGrid() {
            currentMatrix = [[1, 0, 0], [0, 1, 0], [0, 0, 1]];
            document.getElementById('a11').value = 1;
            document.getElementById('a12').value = 0;
            document.getElementById('a13').value = 0;
            document.getElementById('a21').value = 0;
            document.getElementById('a22').value = 1;
            document.getElementById('a23').value = 0;
            document.getElementById('a31').value = 0;
            document.getElementById('a32').value = 0;
            document.getElementById('a33').value = 1;
            
            // Reset rotation sliders
            document.getElementById('rotX').value = 0;
            document.getElementById('rotY').value = 0;
            document.getElementById('rotZ').value = 0;
            document.getElementById('scale').value = 1;
            document.getElementById('rotXValue').textContent = '0°';
            document.getElementById('rotYValue').textContent = '0°';
            document.getElementById('rotZValue').textContent = '0°';
            document.getElementById('scaleValue').textContent = '1.0';
            
            updateMatrixDisplay();
            applyMatrix3d();
        }
        
        function updateMatrixDisplay() {
            const [[a11, a12, a13], [a21, a22, a23], [a31, a32, a33]] = currentMatrix;
            const determinant = calculateDeterminant(currentMatrix);
            
            const vectorX = 1, vectorY = 1, vectorZ = 1;
            const transformedX = a11 * vectorX + a12 * vectorY + a13 * vectorZ;
            const transformedY = a21 * vectorX + a22 * vectorY + a23 * vectorZ;
            const transformedZ = a31 * vectorX + a32 * vectorY + a33 * vectorZ;
            
            // Update the transformation info with all information
            const transformationInfo = document.getElementById('transformationInfo');
            if (transformationInfo) {
                transformationInfo.innerHTML = 
                    `<div>Matrix: [${a11.toFixed(2)}  ${a12.toFixed(2)}  ${a13.toFixed(2)}]</div>
                     <div>        [${a21.toFixed(2)}  ${a22.toFixed(2)}  ${a23.toFixed(2)}]</div>
                     <div>        [${a31.toFixed(2)}  ${a32.toFixed(2)}  ${a33.toFixed(2)}]</div>
                     <div>Input: [1, 1, 1]</div>
                     <div>Output: [${transformedX.toFixed(1)}, ${transformedY.toFixed(1)}, ${transformedZ.toFixed(1)}]</div>
                     <div>Determinant: ${determinant.toFixed(2)}</div>`;
            }
        }
        
        // Set preset transformations
        function setPreset(type) {
            let matrix;
            switch(type) {
                case 'identity':
                    matrix = [[1, 0, 0], [0, 1, 0], [0, 0, 1]];
                    break;
                case 'rotationX90':
                    matrix = createRotationX(90);
                    break;
                case 'rotationY90':
                    matrix = createRotationY(90);
                    break;
                case 'rotationZ90':
                    matrix = createRotationZ(90);
                    break;
                case 'scaling':
                    matrix = createScalingMatrix(2);
                    break;
                case 'shear':
                    matrix = [[1, 1, 0], [0, 1, 0], [0, 0, 1]];
                    break;
            }
            
            currentMatrix = matrix;
            document.getElementById('a11').value = matrix[0][0];
            document.getElementById('a12').value = matrix[0][1];
            document.getElementById('a13').value = matrix[0][2];
            document.getElementById('a21').value = matrix[1][0];
            document.getElementById('a22').value = matrix[1][1];
            document.getElementById('a23').value = matrix[1][2];
            document.getElementById('a31').value = matrix[2][0];
            document.getElementById('a32').value = matrix[2][1];
            document.getElementById('a33').value = matrix[2][2];
            
            updateMatrixDisplay();
            applyMatrix3d();
        }
        
        // Camera controls
        function updateCamera() {
            const rotX = parseFloat(document.getElementById('cameraRotX').value);
            const rotY = parseFloat(document.getElementById('cameraRotY').value);
            const rotZ = parseFloat(document.getElementById('cameraRotZ').value);
            const zoom = parseFloat(document.getElementById('cameraZoom').value);
            
            zoomFactor = zoom;
            
            // Update display values
            document.getElementById('cameraRotXValue').textContent = rotX + '°';
            document.getElementById('cameraRotYValue').textContent = rotY + '°';
            document.getElementById('cameraRotZValue').textContent = rotZ + '°';
            document.getElementById('cameraZoomValue').textContent = zoom.toFixed(1) + 'x';
            
            // Sync with mobile controls
            document.getElementById('mobileCameraRotX').value = rotX;
            document.getElementById('mobileCameraRotY').value = rotY;
            document.getElementById('mobileCameraRotZ').value = rotZ;
            document.getElementById('mobileCameraZoom').value = zoom;
            document.getElementById('mobileCameraRotXValue').textContent = rotX + '°';
            document.getElementById('mobileCameraRotYValue').textContent = rotY + '°';
            document.getElementById('mobileCameraRotZValue').textContent = rotZ + '°';
            document.getElementById('mobileCameraZoomValue').textContent = zoom.toFixed(1) + 'x';
            
            // Apply camera transformation with proper 3D zoom
            demoContainer.style.transform = `rotateX(${rotX}deg) rotateY(${rotY}deg) rotateZ(${rotZ}deg) scale3d(${zoomFactor}, ${zoomFactor}, ${zoomFactor})`;
        }

        function updateMobileCamera() {
            const rotX = parseFloat(document.getElementById('mobileCameraRotX').value);
            const rotY = parseFloat(document.getElementById('mobileCameraRotY').value);
            const rotZ = parseFloat(document.getElementById('mobileCameraRotZ').value);
            const zoom = parseFloat(document.getElementById('mobileCameraZoom').value);
            
            zoomFactor = zoom;
            
            // Update display values
            document.getElementById('mobileCameraRotXValue').textContent = rotX + '°';
            document.getElementById('mobileCameraRotYValue').textContent = rotY + '°';
            document.getElementById('mobileCameraRotZValue').textContent = rotZ + '°';
            document.getElementById('mobileCameraZoomValue').textContent = zoom.toFixed(1) + 'x';
            
            // Sync with desktop controls
            document.getElementById('cameraRotX').value = rotX;
            document.getElementById('cameraRotY').value = rotY;
            document.getElementById('cameraRotZ').value = rotZ;
            document.getElementById('cameraZoom').value = zoom;
            document.getElementById('cameraRotXValue').textContent = rotX + '°';
            document.getElementById('cameraRotYValue').textContent = rotY + '°';
            document.getElementById('cameraRotZValue').textContent = rotZ + '°';
            document.getElementById('cameraZoomValue').textContent = zoom.toFixed(1) + 'x';
            
            // Apply camera transformation with proper 3D zoom
            demoContainer.style.transform = `rotateX(${rotX}deg) rotateY(${rotY}deg) rotateZ(${rotZ}deg) scale3d(${zoomFactor}, ${zoomFactor}, ${zoomFactor})`;
        }

        function resetCamera() {
            const defaultValues = {
                rotX: 30, rotY: 45, rotZ: 0,
                zoom: 1.0
            };
            
            // Reset desktop controls
            document.getElementById('cameraRotX').value = defaultValues.rotX;
            document.getElementById('cameraRotY').value = defaultValues.rotY;
            document.getElementById('cameraRotZ').value = defaultValues.rotZ;
            document.getElementById('cameraZoom').value = defaultValues.zoom;
            
            // Reset mobile controls
            document.getElementById('mobileCameraRotX').value = defaultValues.rotX;
            document.getElementById('mobileCameraRotY').value = defaultValues.rotY;
            document.getElementById('mobileCameraRotZ').value = defaultValues.rotZ;
            document.getElementById('mobileCameraZoom').value = defaultValues.zoom;
            
            // Reset zoom factor
            zoomFactor = defaultValues.zoom;
            
            updateCamera();
        }

        function resetMobileCamera() {
            resetCamera();
        }
        
        function resetView() {
            resetCamera(); // Use the same reset function
        }
        
        // Mouse controls for 3D navigation
        let isMouseDown = false;
        let lastMouseX = 0;
        let lastMouseY = 0;
        
        demoContainer.addEventListener('mousedown', function(e) {
            isMouseDown = true;
            lastMouseX = e.clientX;
            lastMouseY = e.clientY;
            demoContainer.style.cursor = 'grabbing';
        });
        
        demoContainer.addEventListener('mousemove', function(e) {
            if (isMouseDown) {
                const deltaX = e.clientX - lastMouseX;
                const deltaY = e.clientY - lastMouseY;
                
                // Update rotation values
                const currentRotY = parseFloat(document.getElementById('cameraRotY').value);
                const currentRotX = parseFloat(document.getElementById('cameraRotX').value);
                
                document.getElementById('cameraRotY').value = currentRotY + deltaX * 0.5;
                document.getElementById('cameraRotX').value = currentRotX + deltaY * 0.5;
                
                updateCamera();
                
                lastMouseX = e.clientX;
                lastMouseY = e.clientY;
            }
        });
        
        demoContainer.addEventListener('mouseup', function(e) {
            isMouseDown = false;
            demoContainer.style.cursor = 'grab';
        });
        
        demoContainer.addEventListener('wheel', function(e) {
            e.preventDefault();
            const zoomChange = e.deltaY > 0 ? 0.9 : 1.1;
            zoomFactor *= zoomChange;
            updateCamera();
        });
        
        window.onload = function() {
            updateMatrixDisplay();
            applyMatrix3d();
            updateCamera();
        };
    </script>
</body>
</html> 